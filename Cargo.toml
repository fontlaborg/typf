[workspace]
members = [
    # Core crates
    "crates/typf",
    "crates/typf-core",
    "crates/typf-input",
    "crates/typf-unicode",
    "crates/typf-fontdb",
    "crates/typf-export",

    # Shaping backends
    "backends/typf-shape-none",
    "backends/typf-shape-hb",
    "backends/typf-shape-ct",
    # "backends/typf-shape-icu-hb",
    # "backends/typf-shape-mac",
    # "backends/typf-shape-win",

    # Rendering backends
    # "backends/typf-render-json",
    "backends/typf-render-orge",
    "backends/typf-render-cg",
    # "backends/typf-render-skia",
    # "backends/typf-render-zeno",
    # "backends/typf-render-mac",
    # "backends/typf-render-win",

    # CLI
    "crates/typf-cli",

    # Bindings
    "bindings/python",
]
resolver = "2"

[workspace.package]
version = "2.0.0-dev"
authors = ["TYPF Contributors"]
edition = "2021"
rust-version = "1.75"
license = "MIT OR Apache-2.0"
repository = "https://github.com/typf/typf"

[workspace.dependencies]
# Internal crates
typf-core = { path = "crates/typf-core" }
typf-input = { path = "crates/typf-input" }
typf-unicode = { path = "crates/typf-unicode" }
typf-fontdb = { path = "crates/typf-fontdb" }
typf-export = { path = "crates/typf-export" }

# Backends
typf-shape-none = { path = "backends/typf-shape-none" }
typf-shape-hb = { path = "backends/typf-shape-hb" }
typf-shape-ct = { path = "backends/typf-shape-ct" }
typf-render-orge = { path = "backends/typf-render-orge" }
typf-render-cg = { path = "backends/typf-render-cg" }

# External dependencies
read-fonts = "0.20"
skrifa = "0.20"
thiserror = "1.0"
anyhow = "1.0"
log = "0.4"
env_logger = "0.11"

# Shaping dependencies
harfbuzz_rs = "2.0"

# Caching and concurrency
parking_lot = "0.12"
lru = "0.12"

# Optional dependencies (to be added as needed)
# icu = "1.5"
# tiny-skia = "0.11"
rayon = "1.10"

[profile.release]
opt-level = 3
lto = true
codegen-units = 1
strip = true

[profile.release-with-debug]
inherits = "release"
strip = false
debug = true

[profile.bench]
inherits = "release"
lto = false

[profile.minimal]
inherits = "release"
opt-level = "z"  # Optimize for size

# Feature flags for the workspace
# These are referenced by individual crates
[workspace.metadata.features]
# Minimal build with no external dependencies
minimal = ["shaping-none", "render-orge", "export-pnm"]

# Default build with common features
default = ["minimal", "unicode", "fontdb"]

# Full build with all features
full = [
    "default",
    "shaping-hb",
    "shaping-icu-hb",
    "render-skia",
    "render-zeno",
    "export-png",
    "export-svg",
    "export-pdf",
    "simd",
    "parallel",
]

# Shaping backends
shaping-none = []
shaping-hb = []
shaping-icu-hb = ["shaping-hb"]
shaping-mac = []
shaping-win = []

# Rendering backends
render-orge = []
render-skia = []
render-zeno = []
render-mac = []
render-win = []

# Export formats
export-pnm = []
export-png = []
export-svg = []
export-pdf = []
export-json = []

# Optional features
unicode = []
fontdb = []
simd = []
parallel = []

# Platform-specific auto-selection
auto-backend = []